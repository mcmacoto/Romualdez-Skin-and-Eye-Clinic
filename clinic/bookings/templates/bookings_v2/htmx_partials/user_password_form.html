<!-- User Password Reset Form -->
<div class="mb-3">
    <div class="alert alert-info d-flex align-items-center" role="alert">
        <i class="fas fa-info-circle me-2"></i>
        <div>
            <strong>Resetting password for:</strong> {{ user.get_full_name|default:user.username }}
            {% if user.email %}
            <br><small class="text-muted">{{ user.email }}</small>
            {% endif %}
        </div>
    </div>
</div>

<form hx-post="{% url 'bookings_v2:htmx_user_password_reset' user.id %}" 
      hx-target="#passwordResetResponse"
      hx-swap="innerHTML">
    {% csrf_token %}
    
    <div id="passwordResetResponse"></div>
    
    <div class="mb-3">
        <label for="new_password" class="form-label">
            <i class="fas fa-lock"></i> New Password <span class="text-danger">*</span>
        </label>
        <input type="password" 
               class="form-control" 
               id="new_password" 
               name="new_password" 
               required
               minlength="8"
               placeholder="Enter new password (min. 8 characters)">
        <div class="form-text">
            <i class="fas fa-info-circle"></i> Password must be at least 8 characters long
        </div>
    </div>
    
    <div class="mb-3">
        <label for="confirm_password" class="form-label">
            <i class="fas fa-lock"></i> Confirm Password <span class="text-danger">*</span>
        </label>
        <input type="password" 
               class="form-control" 
               id="confirm_password" 
               name="confirm_password" 
               required
               minlength="8"
               placeholder="Re-enter new password">
    </div>
    
    <div class="alert alert-warning d-flex align-items-start" role="alert">
        <i class="fas fa-exclamation-triangle me-2 mt-1"></i>
        <div>
            <strong>Important:</strong>
            <ul class="mb-0 mt-1">
                <li>The user will be able to log in immediately with the new password</li>
                <li>The old password will no longer work</li>
                {% if user.is_staff %}
                <li class="text-danger"><strong>This is a staff member - exercise caution</strong></li>
                {% endif %}
            </ul>
        </div>
    </div>
    
    <div class="d-flex justify-content-end gap-2">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times"></i> Cancel
        </button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-key"></i> Reset Password
        </button>
    </div>
</form>

<script>
    // Client-side password match validation
    document.getElementById('confirm_password').addEventListener('input', function() {
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = this.value;
        
        if (confirmPassword && newPassword !== confirmPassword) {
            this.setCustomValidity('Passwords do not match');
            this.classList.add('is-invalid');
        } else {
            this.setCustomValidity('');
            this.classList.remove('is-invalid');
        }
    });
    
    document.getElementById('new_password').addEventListener('input', function() {
        const confirmPassword = document.getElementById('confirm_password');
        if (confirmPassword.value) {
            confirmPassword.dispatchEvent(new Event('input'));
        }
    });
</script>
