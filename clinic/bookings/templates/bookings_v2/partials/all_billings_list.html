<!-- HTMX Partial: All Billings List -->
<!-- Search Bar -->
<div class="search-bar mb-3">
    <div class="input-group">
        <span class="input-group-text bg-white">
            <i class="fas fa-search text-muted"></i>
        </span>
        <input 
            type="text" 
            class="form-control" 
            placeholder="Search by patient name or service..." 
            name="search"
            hx-get="{% url 'bookings_v2:htmx_all_billings' %}"
            hx-trigger="keyup changed delay:500ms"
            hx-target="#billingsModalBody"
            hx-swap="innerHTML"
            hx-include="this"
        >
    </div>
</div>

{% if billings %}
<div class="table-responsive">
    <table class="table table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th><i class="fas fa-hashtag me-2"></i>Bill #</th>
                <th><i class="fas fa-user me-2"></i>Patient</th>
                <th><i class="fas fa-calendar me-2"></i>Date</th>
                <th><i class="fas fa-list me-2"></i>Service</th>
                <th class="text-end"><i class="fas fa-money-bill-wave me-2"></i>Amount</th>
                <th class="text-end"><i class="fas fa-hand-holding-usd me-2"></i>Paid</th>
                <th class="text-end"><i class="fas fa-balance-scale me-2"></i>Balance</th>
                <th><i class="fas fa-info-circle me-2"></i>Status</th>
                <th class="text-center"><i class="fas fa-cog me-2"></i>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for billing in billings %}
            <tr id="billing-row-{{ billing.id }}">
                <td>
                    <strong>#{{ billing.id }}</strong>
                </td>
                <td>
                    <div>
                        <strong>{{ billing.booking.patient_name }}</strong>
                        <br>
                        <small class="text-muted">
                            <i class="fas fa-envelope"></i> {{ billing.booking.patient_email }}
                        </small>
                    </div>
                </td>
                <td>
                    {{ billing.issued_date|date:"M d, Y" }}
                </td>
                <td>
                    {{ billing.booking.service.name }}
                </td>
                <td class="text-end">
                    <strong>₱{{ billing.total_amount|floatformat:2 }}</strong>
                </td>
                <td class="text-end">
                    <span class="text-success">₱{{ billing.amount_paid|floatformat:2 }}</span>
                </td>
                <td class="text-end">
                    {% if billing.balance > 0 %}
                        <strong class="text-danger">₱{{ billing.balance|floatformat:2 }}</strong>
                    {% else %}
                        <span class="text-success">₱0.00</span>
                    {% endif %}
                </td>
                <td>
                    {% if billing.is_paid %}
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle"></i> Paid
                        </span>
                    {% elif billing.amount_paid > 0 %}
                        <span class="badge bg-warning text-dark">
                            <i class="fas fa-clock"></i> Partially Paid
                        </span>
                    {% else %}
                        <span class="badge bg-danger">
                            <i class="fas fa-times-circle"></i> Unpaid
                        </span>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if not billing.is_paid %}
                    <button 
                        class="btn btn-sm btn-success"
                        hx-post="{% url 'bookings_v2:htmx_mark_paid' billing.id %}"
                        hx-target="#billing-row-{{ billing.id }}"
                        hx-swap="outerHTML"
                        hx-confirm="Mark this bill as fully paid?"
                        title="Mark as Paid"
                    >
                        <i class="fas fa-check"></i> Mark Paid
                    </button>
                    {% else %}
                    <button class="btn btn-sm btn-secondary" disabled>
                        <i class="fas fa-check"></i> Paid
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Billing Summary -->
<div class="row mt-4">
    <div class="col-md-3">
        <div class="card border-primary">
            <div class="card-body text-center">
                <h6 class="card-title text-primary">
                    <i class="fas fa-file-invoice"></i> Total Bills
                </h6>
                <h4 class="mb-0">{{ total_count }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-success">
            <div class="card-body text-center">
                <h6 class="card-title text-success">
                    <i class="fas fa-check-circle"></i> Paid
                </h6>
                <h4 class="mb-0">{{ paid_count }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-warning">
            <div class="card-body text-center">
                <h6 class="card-title text-warning">
                    <i class="fas fa-clock"></i> Partially Paid
                </h6>
                <h4 class="mb-0">{{ partial_count }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-danger">
            <div class="card-body text-center">
                <h6 class="card-title text-danger">
                    <i class="fas fa-times-circle"></i> Unpaid
                </h6>
                <h4 class="mb-0">{{ unpaid_count }}</h4>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-12">
        <div class="card bg-light">
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <h6 class="text-muted">Total Revenue</h6>
                        <h3 class="text-success mb-0">₱{{ total_revenue|floatformat:2 }}</h3>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted">Amount Collected</h6>
                        <h3 class="text-info mb-0">₱{{ amount_collected|floatformat:2 }}</h3>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted">Outstanding Balance</h6>
                        <h3 class="text-danger mb-0">₱{{ outstanding_balance|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info text-center my-4">
    <i class="fas fa-info-circle fa-2x mb-3"></i>
    <h5>No Billing Records Found</h5>
    <p class="mb-0">There are no billing records in the system yet.</p>
</div>
{% endif %}
