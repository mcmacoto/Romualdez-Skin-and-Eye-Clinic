<tr id="appointment-row-{{ appointment.id }}">
    <td>
        <div>
            <strong>{{ appointment.patient_name }}</strong>
            <br>
            <small class="text-muted">
                <i class="fas fa-envelope"></i> {{ appointment.patient_email }}
            </small>
        </div>
    </td>
    <td>
        <strong>{{ appointment.date|date:"M d, Y" }}</strong>
    </td>
    <td>
        <span class="badge bg-info">
            {{ appointment.time|time:"g:i A" }}
        </span>
    </td>
    <td>{{ appointment.service.name }}</td>
    <td>
        <select 
            class="form-select form-select-sm"
            name="doctor"
            hx-post="{% url 'bookings_v2:htmx_update_appointment_doctor' appointment.id %}"
            hx-target="#appointment-row-{{ appointment.id }}"
            hx-swap="outerHTML"
            hx-trigger="change"
            style="min-width: 150px;"
        >
            <option value="">Not assigned</option>
            {% for doctor in available_doctors %}
            <option value="{{ doctor.id }}" {% if appointment.doctor and appointment.doctor.id == doctor.id %}selected{% endif %}>
                {{ doctor.get_full_name }}
            </option>
            {% endfor %}
        </select>
    </td>
    <td>
        {% if appointment.status == 'Confirmed' %}
            <span class="badge bg-success">
                <i class="fas fa-check-circle"></i> Confirmed
            </span>
        {% elif appointment.status == 'Pending' %}
            <span class="badge bg-warning text-dark">
                <i class="fas fa-clock"></i> Pending
            </span>
        {% elif appointment.status == 'Completed' %}
            <span class="badge bg-primary">
                <i class="fas fa-check-double"></i> Completed
            </span>
        {% elif appointment.status == 'Cancelled' %}
            <span class="badge bg-danger">
                <i class="fas fa-times-circle"></i> Cancelled
            </span>
        {% else %}
            <span class="badge bg-secondary">{{ appointment.status }}</span>
        {% endif %}
    </td>
    <td>
        {% if appointment.status == 'Confirmed' %}
        <select 
            class="form-select form-select-sm"
            name="consultation_status"
            hx-post="{% url 'bookings_v2:htmx_update_consultation_status' appointment.id %}"
            hx-target="#appointment-row-{{ appointment.id }}"
            hx-swap="outerHTML"
            hx-trigger="change"
            style="min-width: 130px;"
        >
            <option value="Not Yet" {% if appointment.consultation_status == 'Not Yet' %}selected{% endif %}>
                Pending
            </option>
            <option value="Ongoing" {% if appointment.consultation_status == 'Ongoing' %}selected{% endif %}>
                Ongoing
            </option>
            <option value="Done" {% if appointment.consultation_status == 'Done' %}selected{% endif %}>
                Done
            </option>
        </select>
        {% else %}
            {% if appointment.consultation_status == 'Done' %}
                <span class="badge bg-success">
                    <i class="fas fa-check"></i> Done
                </span>
            {% elif appointment.consultation_status == 'Ongoing' %}
                <span class="badge bg-info">
                    <i class="fas fa-spinner"></i> Ongoing
                </span>
            {% else %}
                <span class="badge bg-secondary">
                    <i class="fas fa-hourglass-half"></i> Not Yet
                </span>
            {% endif %}
        {% endif %}
    </td>
    <td class="text-center">
        <div class="btn-group btn-group-sm">
            {% if appointment.status != 'Completed' and appointment.status != 'Cancelled' %}
            <button 
                class="btn btn-outline-primary"
                hx-get="{% url 'bookings_v2:htmx_appointment_edit_form' appointment.id %}"
                hx-target="#appointmentsModalBody"
                hx-swap="innerHTML"
                title="Edit"
            >
                <i class="fas fa-edit"></i>
            </button>
            {% endif %}
            <button 
                class="btn btn-outline-danger"
                hx-delete="{% url 'bookings_v2:htmx_delete_appointment' appointment.id %}"
                hx-target="#appointment-row-{{ appointment.id }}"
                hx-swap="outerHTML swap:1s"
                hx-confirm="Are you sure you want to delete this appointment?"
                title="Delete"
            >
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </td>
</tr>
